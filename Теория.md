# Теоретическая часть.
## 1. Подготовка к организации изолированной сети
### 1.1 Построение логической топологии
Для начала необходимо разработать топологию данной сети. То есть как обьекты сети будут между собой взаимодействовать и как будет реализована та или иная топология.

Для данной работы будет использовано два сервера. Обозначим сервера 1 и 2 соответственно SE1, SE2. У данных серверов есть внешние IP адреса, так как они будут передавать данные между собой.

Так же в данной топологии будет два компьютера, которые я обозначу PC1 и PC2 соотвественно. Данная изолированная сеть будет иметь доменный контроллер под управлением Samba и средства управления им на клиентских машинах. А данные с доменных контроллеров будут реплицироваться с SE1 на SE2 и наоборот.
Таким образом можем представить такую карту сети:
![Logical Topology](https://user-images.githubusercontent.com/58629552/172162321-5993be3a-9cb7-47f2-b9d6-c67b54e49abc.png)
*Рис.1. Топология*

На данной топологии видно, что VPN туннель будет проходить от SE1 к PC1 и от SE2 к PC2. На SE1 и на SE2 будет одинаковый набор сервисов, поскольку репликация должна работать в обе стороны.
### 1.2 Выбор операционной системы для сервера
Поскольку Samba будет контроллером Active Directory, то операционная система будет Linux. Но нужно выбрать на каком семействе линукс будет работать контроллер. Либо GNU/Linux, либо Rhel. Сначала надо рассмотреть преимущества тех или иных семейств и систем.

1.2.1. Семейство GNU/Linux
В семейство GNU/Linux входят такие системы как Ubuntu, Debian, Kali и другие. Они используются для различных целей и задач, поэтому их можно использовать как контроллеры Active Directory. Ubuntu чаще всего используется как операционная система для персонального компьютера, хоть у нее есть серверная версия. Но, к сожалению, в ней чаще всего происходят ошибки ядра, так что она не подходит. Kali - система, которая предназначена для пентеста, то есть тестирования систем или устройств на уязвимости и не подходит на роль сервера. На текущий момент самой стабильной системой, которая имеет поддержку из трех систем, которые я назвал - это Debian. Он может выдержать довольно большие нагрузки и предназначен как для использования на персональном пк, так и в качестве сервера. Теперь рассмотрим семейство Rhel.

1.2.2. Семейство RHEL
В семейство RHEl входит сам RHEl (Red Hat Enterprise Linux) и CentOS. CentOS основан на RHEL, но поддержка CentOS в компании Red Hat прекращается уже через год, поэтому если его выбрать как серверную систему, для развертывания доменного контроллера. В таком случае, при возникновения неизвестной ошибки, обратиться за помощью будет не куда. Что касается, Red Hat Enterprise Linux, то RHEL является платным, поэтому лучше выбрать любую систему из семейства Gnu/Linux.

В итоге, выбор системы для развертывания VPN, Active Directory на Samba лучше остановить на Debian из семейства GNU/Linux.

## 2. VPN
### 2.1 Принцип работы VPN
VPN – Virtual Private Network – виртуальная частная сеть. Это совокупность технологий, позволяющих обеспечить сетевые соединения поверх логической.
Принцип работы VPN достаточно прост:
1. VPN клиент отправляет серверу запрос
2. Сервер его расшифровывает
3. Выполняет запрос
4. Шифрует ответ от сайта
5. Возвращает зашифрованный ответ VPN клиенту
6. VPN клиент расшифровывает ответ

Примеров использования VPN очень много. Приведем три из них: Если человек сидит в людном месте и подключен к публичной сети, то он может подключиться к VPN и его соединение будет защищено. Или есть другой способ применения VPN. Если в стране закрыт доступ к какому-либо сайту, подключившись к VPN сети в другой стране, можно просматривать сайт без проблем. Или еще одно третье применение VPN. Если сотрудникам в компании нужно удаленно работать и они все должны иметь возможность обмениваться файлами в одной локальной сети, то они могут подключится к корпоративному VPN и взаимодействовать между собой.

### 2.2 Протоколы для реализации VPN
#### 2.2.1. PPTP
PPTP (Point To Point Tunneling Protocol) использует одно соединение, которое работает на 1723 порту, с использованием TCP для управления, а так же другое соединение, работающее с помощью транспортного протокола GRE, для инкапсуляции данных. Этот факт мешает клиентам, которые находятся за NAT, установить подключение с сервером, потому что для них установление подключения point-to-point не предоставляется возможным. Но, из-за того, что в протоколе GRE, который используется PPTP (enhanced GRE), находится заголовок Call ID, маршрутизаторы, которые выполняют функции NAT, могут обнаружить трафик GRE, который идет по локальной сети от клиента к внешнему серверу и наоборот. Это позволяет клиентам за NAT установить подключение point-to-point и пользоваться протоколом GRE. Эта технология называется VPN PassThrough. Она поддерживается большинством современных клиентских компьютеров и сетевого оборудования.

#### 2.2.2. L2TP
L2TP использует протокол UDP как транспорт, а так же использует для
пересылки данных такой же формат сообщений, как и для управления
туннелем. В реализации Microsoft L2TP использует как контрольные
сообщения UDP пакеты, которые содержат зашифрованные пакеты PPP.

Чтобы обеспечить безопасность L2TP-пакетов чаще всего используется
протокол IPSec, который обеспечивает конфиденциальность, целостность и
аутентификацию. Связка этих протокол известна как L2TP/IPSec.
Конечных узлов L2TP туннеля два. Один из них LAC (L2TP Access
Controller) является инициатором туннеля. Другой LNS (L2TP Network
Server) - это сервер, который ожидает появление новых туннелей. Когда
туннель установлен, трафик между узлами направлен в обе стороны. После
установления туннеля, внутри него запускаются протоколы более высоких
уровней. С этой целью, L2TP сессия устанавливается внутри туннеля для
каждого протокола более высокого уровня. (например, для PPP). И LAC, и
LNS могут инициировать сессии. Трафик для каждой из сессий изолируется с
помощью L2TP, таким образом появляется возможность настроить несколько
виртуальных сетей в одном туннеле.

#### 2.2.3. SSTP

#### 2.2.4. IPSec
