# Скрины и описания к скринам
## Настройка сервера 1.
![image](https://user-images.githubusercontent.com/58629552/170886004-47f3771f-ad37-4f2c-a3af-c2856a4e1d67.png)
> Установка необходимых пакетов

![image](https://user-images.githubusercontent.com/58629552/170886034-00d19132-705f-45bb-89d9-a7ac33d5f170.png)
> Скачивание установщика VPN сервера

![image](https://user-images.githubusercontent.com/58629552/170886054-2ce48c14-7100-4348-982a-49d26d6f32b9.png)
> Ввод данных, которые будут использованы при конфигурации

![image](https://user-images.githubusercontent.com/58629552/170886065-5ffb4935-5d4f-48da-a93b-65c1ea368e8e.png)
> Запуск установщика

![image](https://user-images.githubusercontent.com/58629552/170886085-5a074920-0319-4cb0-aa12-7c78a1a476fd.png)
> Конец работы установщика

![image](https://user-images.githubusercontent.com/58629552/170886115-6a2e38d1-fb93-4fd1-9435-11d5f20cce42.png)
> Скачивание системы управления Vpn серверами. Через нее будет обеспечена авторизация в Vpn серверах по базе Active directory (на базе Samba) с помощью freeradius.

![image](https://user-images.githubusercontent.com/58629552/170886148-d70219e1-6e26-43e6-a7b2-d4086aea520f.png)
> Распаковка системы

![image](https://user-images.githubusercontent.com/58629552/170886175-2a40c1d4-1ff0-4cf1-8919-c277e03a7091.png)
> Запуск сборки системы из исходников

![image](https://user-images.githubusercontent.com/58629552/170886223-3a335e87-4715-4d67-8b87-0fe83e15a679.png)
> Ошибка в сборке

![image](https://user-images.githubusercontent.com/58629552/170886264-503794fa-f10a-43da-937e-f36465080791.png)
> Место ошибки до исправления

![image](https://user-images.githubusercontent.com/58629552/170886274-b958acf8-3151-44ff-95c4-b338880e42c1.png)
> Место ошибки после исправления

![image](https://user-images.githubusercontent.com/58629552/170886293-c9950e7b-5edb-4e4f-84af-6e38242b86fd.png)
> Вторая ошибка в сборке

![image](https://user-images.githubusercontent.com/58629552/170886320-7edc9392-5ed7-44fb-9fec-62480ddc78d7.png)
> Исправления второй ошибки в сборке

![image](https://user-images.githubusercontent.com/58629552/170886325-06603d51-a7a3-4bf0-a375-236a5f488a40.png)
> Успешная сборка

![image](https://user-images.githubusercontent.com/58629552/170886350-1116150c-8e26-437e-9ece-1570a5c2e9f5.png)
> Установка системы

![image](https://user-images.githubusercontent.com/58629552/170886358-c9710369-8722-4861-9af4-723e53bf5d9d.png)
> Определение местоположения скрипта запуска системы

![image](https://user-images.githubusercontent.com/58629552/170886368-e2be7a64-8562-4a86-834b-0d8618fd94fe.png)
> Изменение настройки пути скрипта в systemd (До)

![image](https://user-images.githubusercontent.com/58629552/170886405-5989c3e6-bb48-4532-a365-7e7cc4729fd9.png)
> Изменение настройки пути скрипта в systemd (После)

![image](https://user-images.githubusercontent.com/58629552/170886422-5d626817-f636-417f-95f3-fe3573ffd3b6.png)
> Установка пользователя VPN в /etc/ppp/chap-secrets

![image](https://user-images.githubusercontent.com/58629552/170886437-3e38e5f7-714f-45a3-8093-37cc42fb365d.png)
> Начальная конфигурация системы управления VPN серверами

![image](https://user-images.githubusercontent.com/58629552/170886456-3ce863f3-343b-4478-9337-e64fb9c15278.png)
> Запуск системы управления VPN серверами

![image](https://user-images.githubusercontent.com/58629552/170886468-dccb4979-fd4b-4db2-bbc0-d1aa9fc8f548.png)
> Инициализация доменного контроллера

![image](https://user-images.githubusercontent.com/58629552/170886481-ba272303-28ad-448a-a724-ec47a2380e9e.png)
> Данные инициализации доменного контроллера

![image](https://user-images.githubusercontent.com/58629552/170886494-f8c6f0d2-85f1-4e17-8f65-c71a5147e1a3.png)
> Выделенные данные инициализации доменного контроллера

![image](https://user-images.githubusercontent.com/58629552/170886516-4836507a-2934-4952-a06f-da6749dfbff2.png)
> Сохранение пути к новому файлу конфигурации Kerberos

![image](https://user-images.githubusercontent.com/58629552/170886542-887bc4f7-2d15-4a87-a46b-33a7114c9e19.png)
> Установка Kerberos

![image](https://user-images.githubusercontent.com/58629552/170886551-1ec7affb-ad49-4a3b-9b7c-3ef2b5258dee.png)
> Настройка Kerberos (ничего не ввожу, потому что файл конфигурации все равно заменю на тот, который от Samba)

![image](https://user-images.githubusercontent.com/58629552/170886572-d004b655-4743-4490-89f1-549b56593a03.png)
> Снова настройка Kerberos (снова ничего не ввожу, потому что файл конфигурации все равно заменю на тот, который от Samba)

![image](https://user-images.githubusercontent.com/58629552/170886635-db7dc186-767e-4797-8ee1-990ffe4a14dc.png)
> Заменяю файл

![image](https://user-images.githubusercontent.com/58629552/170886654-d972f61d-e011-4d8b-9d04-37b6810e538e.png)
> Запускаю сервер Active Directory на базе Samba

![image](https://user-images.githubusercontent.com/58629552/170886665-fbf243c0-5510-46b7-beb5-d02586701add.png)
> Сервер Active Directory запущен без ошибок

![image](https://user-images.githubusercontent.com/58629552/170886677-d43b9750-a636-49be-9b86-297fa0e48562.png)
> Где я написал, что я его запускаю

![image](https://user-images.githubusercontent.com/58629552/170886683-44359ad2-6c63-4011-9bb1-e58e0d21828c.png)
> Подпроцесс, который отвечает за авторизацию пользователей в Active Directory через ntlm_auth

![image](https://user-images.githubusercontent.com/58629552/170886700-ce69bdc3-bb3f-41af-9e0c-3e2e83838060.png)
> Поскольку компания, где я это разворачиваю сделала уточнение, что они хотят удобную инфраструктуру без рекламы, я решил воспользоваться dns серверами adguard.

![image](https://user-images.githubusercontent.com/58629552/170886727-0742d5ee-75be-4b99-bad4-c43ed94edead.png)
> Выбираю адреса серверов

![image](https://user-images.githubusercontent.com/58629552/170886734-d0a2105b-c238-4fc7-8c87-0e8b00d8b5fb.png)
> Мне нужны те, которые plain просто для bind9, так как он будет служить кеширующим dns сервером, а так же основным dns сервером для внутреннего домена.

![image](https://user-images.githubusercontent.com/58629552/170886778-320c17ce-f555-42ce-bf9a-e112d1181c63.png)
> Конфигурация Bind9

![image](https://user-images.githubusercontent.com/58629552/170886789-720acd56-d83c-4dab-a439-7881f945e10a.png)
> Конфигурация Bind9 с указанием места настройки Dns серверов

![image](https://user-images.githubusercontent.com/58629552/170886823-e0da6b0e-ba1b-4f8f-a3cf-b058c6a96fc5.png)
> Bind9 успешно запустился

![image](https://user-images.githubusercontent.com/58629552/170886830-13fc906c-bf05-43c7-819f-ecc35d922033.png)
> Ищу файл домена в файлах конфигурации samba

![image](https://user-images.githubusercontent.com/58629552/170886865-57eb1669-7bde-460c-bf9f-8c76d260b0b1.png)
> Файл конфигурации до добавления доменной зоны

![image](https://user-images.githubusercontent.com/58629552/170886885-49e9ddb1-8ab0-49b5-85a2-edf34ffd9c2d.png)
> Файл конфигурации после добавления доменной зоны

![image](https://user-images.githubusercontent.com/58629552/170886902-b18cba82-8149-4195-b333-fb71f42d8fad.png)
> Bind9 перезапустился без ошибок

![image](https://user-images.githubusercontent.com/58629552/170886951-b696f665-e8e4-4d79-9d53-9171dd4dbfac.png)
> Доменная зона успешно загрузилась в dns сервер

![image](https://user-images.githubusercontent.com/58629552/170886968-5513cad6-016f-4580-aba8-91ab34cd0e12.png)
> Дополнительная проверка dns записи домена

![image](https://user-images.githubusercontent.com/58629552/170886990-b8d0b162-fb87-4a61-ba61-3518c206da5d.png)
> Проверяем, что наш домен есть только внутри нашего сервера

![image](https://user-images.githubusercontent.com/58629552/170887024-309201cf-8e0d-44ef-8e99-f27237913083.png)
> Чтобы наш сервер корректно работал, добавляю в файл конфигурации dns локальный dns сервер как основной и сервер от google dns как запасной

![image](https://user-images.githubusercontent.com/58629552/170887085-8d958280-e569-4d7c-bcbb-324542a3dec8.png)
> Устанавливаем IpSec

![image](https://user-images.githubusercontent.com/58629552/170887093-000947aa-e49e-4503-94b9-a095a82429e2.png)
> Оставляем файлы конфигурации как есть

![image](https://user-images.githubusercontent.com/58629552/170887104-9004b6c8-d742-4f68-baea-77ef49a81b8e.png)
> Файл конфигурации до изменения

![image](https://user-images.githubusercontent.com/58629552/170887111-b6aa1085-534c-41b8-bc7b-8050a07cf6fc.png)
> Добавляем связь с системой управления VPN серверами.

![image](https://user-images.githubusercontent.com/58629552/170887129-7bc02751-04d7-4eaf-b0e6-899fb91b41e4.png)
> Включаем модуль для связи с FreeRadius в IpSec

![image](https://user-images.githubusercontent.com/58629552/170887155-2929bc6f-7b55-48dd-8e80-31ddbadff4ac.png)
> Перезапускаем, ошибок нет

![image](https://user-images.githubusercontent.com/58629552/170887174-0f11329e-3608-4e80-8f0f-198233e57f88.png)
> Настройка связи freeradius и Accel-VPN

![image](https://user-images.githubusercontent.com/58629552/170887217-f4e84987-8228-46ac-8234-2e8ede81bb7f.png)
> Настройка процесса AAA (Authorization, Autentification, Accounting)

![image](https://user-images.githubusercontent.com/58629552/170887238-3df8baa8-cdee-4386-baf7-6739f0326836.png)
> Все запущено успешно

![image](https://user-images.githubusercontent.com/58629552/170887253-5c05f14c-666b-4239-a0a2-00e327a291c8.png)
> Настраиваем пул Ip адресов для VPN

![image](https://user-images.githubusercontent.com/58629552/170887260-3df3250d-dc9f-4bb1-83e9-33942520b4c6.png)
> Ищем утилиту для авторизации в домене

![image](https://user-images.githubusercontent.com/58629552/170887273-1accb014-965c-4dd1-85c2-2ab426534ffa.png)
> Вставляем ее путь в модуль авторизации в FreeRadius

![image](https://user-images.githubusercontent.com/58629552/170887287-a443768d-5396-46fe-a7d6-338040ecc528.png)
> Настраиваем модуль авторизации зашифрованным паролем от VPN

![image](https://user-images.githubusercontent.com/58629552/170887307-23b1bdeb-9527-49c9-ab2b-5dd9dbdb6ddf.png)
> Вставляем путь утилиты в модуль авторизации зашифрованным паролем от VPN

![image](https://user-images.githubusercontent.com/58629552/170887338-df5cdf37-7ee2-49e1-a35c-76f5772fc3aa.png)
> В конфигурацию доменного контроллера на Samba, дописываем строчку, разрешающую авторизацию зашифрованным паролем от VPN

![image](https://user-images.githubusercontent.com/58629552/170887369-c8992912-e242-48f9-b476-84e42a0e0672.png)
> Перезапускаю samba и dns сервер

![image](https://user-images.githubusercontent.com/58629552/170887425-5ec247f4-3d5e-4df1-8a78-427d8612102b.png)
> Смотрю статус FreeRadius

![image](https://user-images.githubusercontent.com/58629552/170887437-999b0d3c-ac86-4af7-ae74-a5d347242d29.png)
> Добавляю оповещения о плохих подключениях ( в целях тестирования )

![image](https://user-images.githubusercontent.com/58629552/170887459-b671ef56-de55-461a-8127-45fe568e2a64.png)
> Добавляю Dns сервера

![image](https://user-images.githubusercontent.com/58629552/170887468-6598653f-2408-45f2-b115-eca2c1a09d6d.png)
> Настраиваю подключение по ключу к freeradius

![image](https://user-images.githubusercontent.com/58629552/170887481-816e91b7-3121-482b-a4fb-7f8a71368032.png)
> Устанавливаю пароль на L2TP

![image](https://user-images.githubusercontent.com/58629552/170887492-74a1291c-0568-44a5-8f5f-e661e732baa9.png)
> Перезапускаю все сервисы

## Настройка клиента
![image](https://user-images.githubusercontent.com/58629552/170887508-a30a7da9-42a0-413a-a9ec-71518baf948d.png)
> Настраиваю VPN подключение на клиенте

![image](https://user-images.githubusercontent.com/58629552/170887519-c1ae7487-5f7d-49ef-9217-a7967da92479.png)
> Сохранение конфигурации

![image](https://user-images.githubusercontent.com/58629552/170887529-a226ec53-84c8-454d-a540-b6fc0e9960fd.png)
> Вхожу в VPN сервер

![image](https://user-images.githubusercontent.com/58629552/170887536-19bcf85c-56b4-48a1-9efd-75f9ccd47075.png)
> Успешно подключился к VPN

![image](https://user-images.githubusercontent.com/58629552/170887548-bc144e8b-d756-4280-9ed6-8ac0bab2808a.png)
> Проверяю подключение

![image](https://user-images.githubusercontent.com/58629552/170887551-c0ec1243-f885-4bff-affd-ac441d3cb15b.png)
> Вхожу в домен на клиенте

![image](https://user-images.githubusercontent.com/58629552/170887562-6d616fde-5fcb-4f5b-9ed4-b81bf57f504b.png)
> Успешно вошел в домен на клиенте

![image](https://user-images.githubusercontent.com/58629552/170887566-75c4f5b6-7b35-4ebc-ae71-2ed11ab502a1.png)
> Проверяю, что копьютер появился в базе Active Directory

## Настройка второго доменного контроллера
![image](https://user-images.githubusercontent.com/58629552/170887590-85a5c4e1-5427-4325-96a0-acb5bc933ee7.png)
> Подключение Samba как члена доменной сети

![image](https://user-images.githubusercontent.com/58629552/170887669-05763afe-bc4a-4513-a161-77d6b619206c.png)
> Проверяю, что видит правильный домен

![image](https://user-images.githubusercontent.com/58629552/170887711-445e201f-ed30-4394-9ef1-39ca2cad3b63.png)
> Проверяю подключение к домену

![image](https://user-images.githubusercontent.com/58629552/170887731-aced3e93-f7f1-4cea-816e-ce41b61a409a.png)
> Ввожу доменный контроллер в домен

![image](https://user-images.githubusercontent.com/58629552/170887757-170e50d2-38a3-41ff-9148-c968846eaaf3.png)
> Проверяю успешный ввод в домен

![image](https://user-images.githubusercontent.com/58629552/170887804-42239208-a1c4-47db-87f2-5df2e816bf73.png)
> Создаю пользователя на основном доменном контроллере

![image](https://user-images.githubusercontent.com/58629552/170887935-646ac3b3-f381-4c05-b35f-17f46411820b.png)
> Пользователь добавился

